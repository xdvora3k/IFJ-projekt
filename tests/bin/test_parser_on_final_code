#!/bin/bash
#
# Run test_parser_on_final_code against real .go files
#
# Synopsis:
#     test_parser_on_final_code
#

SELF="${0##*/}"
SELF_FQ=$(realpath -P $0)
ROOT=$(dirname $(dirname $(dirname $SELF_FQ)))

[[ -f "proj" ]] || make || exit 1

errors=0
for gofile in $ROOT/tests/test_files/real_examples/*; do
    echo "$SELF: Running project on file: $gofile"
    ./proj < "$gofile"
    error=$?
    [[ $error -eq 0 ]] || errors=$((errors + 1))
    echo "$SELF: error code: $error"
done

exit $errors
